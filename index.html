<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"></meta>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"></meta>
    <title>QATLLI - Encantos da Lua</title>
    <style>
        :root {
            --primary-green: #2d5a27;
            --light-green: #e8f5e9;
            --accent-green: #4caf50;
            --text-dark: #2c3e50;
            --bg-white: #ffffff;
            --classic-serif: 'Georgia', 'Times New Roman', serif;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-white);
            color: var(--text-dark);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header-section { text-align: center; margin-bottom: 40px; }
        h1 { font-weight: 300; letter-spacing: 8px; color: var(--primary-green); margin: 0; }
        .welcome-text { font-style: italic; color: #666; margin-top: 5px; font-size: 1.1rem; }

        .year-controls {
            display: flex; align-items: center; justify-content: center;
            gap: 20px; margin-top: 15px;
        }

        .nav-btn {
            background: none; border: 1px solid var(--primary-green);
            color: var(--primary-green); cursor: pointer;
            padding: 5px 12px; border-radius: 20px; transition: 0.2s;
        }
        .nav-btn:hover { background: var(--primary-green); color: white; }

        .year-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 25px; max-width: 1200px; width: 100%; margin-bottom: 50px;
        }
        .month { background: #fdfdfd; padding: 15px; border-radius: 15px; border: 1px solid #f0f0f0; }
        .month-name { font-weight: 600; color: var(--primary-green); text-align: center; text-transform: uppercase; margin-bottom: 5px; }
        
        .month-lunar-phases { 
            display: flex; justify-content: space-around; 
            font-size: 0.7rem; color: #777; margin-bottom: 12px; 
            border-bottom: 1px solid #eee; padding-bottom: 8px; 
        }

        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; font-size: 0.75rem; text-align: center; }
        .day { padding: 5px; color: #888; cursor: pointer; border-radius: 50%; transition: 0.2s; }
        .day:hover { background: var(--light-green); color: var(--primary-green); transform: scale(1.1); }
        .today { background: var(--accent-green) !important; color: white !important; font-weight: bold; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; 
            justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-content {
            background: white; padding: 40px; border-radius: 25px;
            max-width: 450px; width: 90%; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative; animation: modalPop 0.3s ease-out;
        }
        @keyframes modalPop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .close-modal { position: absolute; top: 20px; right: 25px; font-size: 1.5rem; cursor: pointer; color: #999; }

        .ia-section {
            width: 100%; max-width: 600px; background: var(--light-green);
            padding: 30px; border-radius: 24px; border: 1px solid #dceada;
            margin-bottom: 60px; text-align: center;
        }
        .ia-instruction { font-size: 1rem; color: var(--primary-green); margin-bottom: 15px; display: block; font-weight: 500; }
        textarea {
            width: 100%; height: 100px; border: 1.5px solid #c8d6c7;
            border-radius: 12px; padding: 15px; font-size: 1rem;
            box-sizing: border-box; outline: none; margin-bottom: 15px;
        }
        #btn-ia {
            width: 100%; background: var(--primary-green); color: white;
            border: none; padding: 15px; border-radius: 12px;
            cursor: pointer; font-weight: 600;
        }

        .moon-content { max-width: 800px; width: 100%; line-height: 1.8; color: #333; text-align: justify; }
        .moon-content h2 { font-family: var(--classic-serif); font-size: 2.5rem; color: var(--primary-green); text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--light-green); padding-bottom: 10px; }
        .topic-list { list-style: none; padding: 0; }
        .topic-list li { margin-bottom: 25px; padding-left: 20px; border-left: 3px solid var(--accent-green); }
        .topic-title { font-weight: bold; display: block; font-size: 1.1rem; color: var(--primary-green); margin-bottom: 5px; }
      
      
      
.slider-container {
    width: 100%;
    max-width: 1200px;
    margin: 60px auto;
    text-align: center;
}

/* Container centralizador dos cards */
.slider-track {
    display: flex;
    flex-wrap: wrap; /* Permite quebrar linha em telas pequenas */
    justify-content: center; /* Centraliza os cards horizontalmente */
    gap: 25px;
    padding: 20px;
}

.slide-card {
    width: 260px; /* Largura fixa para manter a simetria */
    height: 380px;
    background: #fff;
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    text-decoration: none;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid #f0f0f0;
}

.slide-card:hover { 
    transform: translateY(-15px); 
    box-shadow: 0 20px 40px rgba(45, 90, 39, 0.15);
}

.slide-img {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    filter: brightness(0.9);
    transition: 0.5s;
}

.slide-card:hover .slide-img {
    filter: brightness(1.1);
    transform: scale(1.05);
}

.slide-footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: linear-gradient(transparent, rgba(45, 90, 39, 0.95)); /* Degrad√™ elegante */
    color: white;
    padding: 25px 15px;
    text-align: center;
    font-size: 0.9rem;
    font-weight: 600;
    letter-spacing: 1px;
}

.mathematician-quote {
    max-width: 650px;
    margin: 0 auto 30px;
    padding: 0 20px;
}

.mathematician-quote p {
    font-size: 1.1rem;
    color: #555;
    font-style: italic;
    line-height: 1.6;
}

.mathematician-quote small {
    display: block;
    margin-top: 10px;
    color: var(--primary-green);
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 2px;
}    





</style>
</head>
<body>


  
  
    <div class="header-section">
        <h1>QATLLI</h1>
        <div class="welcome-text">Bem-vindo aos Encantos da Lua</div>
     <p><i> "O QATLLI √© uma fus√£o entre o c√©u e a alma. Um espa√ßo onde a precis√£o da astronomia encontra a sensibilidade da literatura, mediadas por uma intelig√™ncia artificial que entende n√£o apenas os ciclos da lua, mas os ciclos do sentimento humano."</i></p>
      
        <div class="welcome-text">Clique em um dia para ver o Or√°culo</div>
      
      
      
        <div class="year-controls">
            <button class="nav-btn" onclick="changeYear(-1)">‚Üê</button>
            <span id="year-display" style="font-size: 1.5rem; font-weight: bold;">2026</span>
            <button class="nav-btn" onclick="changeYear(1)">‚Üí</button>
        </div>
    </div>

    <div class="year-container" id="calendar"></div>

    <div class="modal-overlay" id="modal-lunar" onclick="fecharModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-modal" onclick="document.getElementById('modal-lunar').style.display='none'">√ó</span>
            <h2 id="modal-data" style="color: var(--primary-green); font-family: var(--classic-serif); margin-bottom: 10px;"></h2>
            <div id="modal-icone" style="font-size: 4rem; margin: 20px 0;"></div>
            <h3 id="modal-fase-nome" style="color: var(--accent-green); margin: 0;"></h3>
            <p id="modal-conselho" style="color: #555555; font-size: 1.1rem; font-style: italic; line-height: 1.6; margin-top: 20px;"></p>
        </div>
    </div>
<center>
    <div class="ia-section">
        <span class="ia-instruction">Escreva o que voc√™ est√° sentindo hoje, e ter√° uma pequena an√°lise deste seu sentimento: IA QATLLI</span>
        <textarea disabled="" id="texto-ia" placeholder="Relate seus pensamentos..."></textarea>
        <button disabled="" id="btn-ia" onclick="analisar()">Iniciando Motor Multil√≠ngue...</button>
        <div id="resultado" style="background: white; border-left: 4px solid var(--primary-green); border-radius: 10px; display: none; margin-top: 15px; padding: 15px; text-align: left;"></div>
    </div>

  
  
  <style>
    .impactful-themes {
        width: 100%;
        max-width: 800px;
        margin-bottom: 60px;
    }
    .themes-title {
        font-family: var(--classic-serif);
        font-size: 2rem;
        color: var(--primary-green);
        text-align: center;
        margin-bottom: 30px;
    }
    .eclipse-card {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 20px;
        transition: 0.3s;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    .eclipse-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    .eclipse-date {
        background: var(--primary-green);
        color: white;
        padding: 10px;
        border-radius: 10px;
        min-width: 100px;
        text-align: center;
        font-weight: bold;
    }
    .eclipse-info h4 { margin: 0 0 5px 0; color: var(--primary-green); }
    .eclipse-info p { margin: 0; font-size: 0.9rem; color: #666; }
    .nasa-link {
        margin-left: auto;
        text-decoration: none;
        color: var(--accent-green);
        font-weight: bold;
        font-size: 0.8rem;
        border: 1px solid var(--accent-green);
        padding: 5px 10px;
        border-radius: 5px;
        transition: 0.2s;
    }
    .nasa-link:hover { background: var(--accent-green); color: white; }
</style>

<div class="impactful-themes">
    <h3 class="themes-title">Temas Impactantes da Lua</h3>
    
    <div class="eclipse-card">
        <div class="eclipse-date">14 MAR<br />2025</div>
        <div class="eclipse-info">
            <h4>Eclipse Lunar Total</h4>
            <p><strong>Fato:</strong> Conhecida como "Lua de Sangue", a Lua atravessa a sombra total da Terra, adquirindo um tom avermelhado dram√°tico. Ser√° vis√≠vel em todas as Am√©ricas.</p>
        </div>
        <a class="nasa-link" href="https://eclipse.gsfc.nasa.gov/lunar.html" target="_blank">DADOS NASA</a>
    </div>

    <div class="eclipse-card">
        <div class="eclipse-date">07 SET<br />2025</div>
        <div class="eclipse-info">
            <h4>Eclipse Lunar Total</h4>
            <p><strong>Fato:</strong> Um eclipse excepcionalmente profundo onde a Lua passar√° quase exatamente pelo centro da sombra da Terra, resultando em uma escurid√£o intensa.</p>
        </div>
        <a class="nasa-link" href="https://eclipse.gsfc.nasa.gov/lunar.html" target="_blank">DADOS NASA</a>
    </div>

    <div class="eclipse-card">
        <div class="eclipse-date">03 MAR<br />2026</div>
        <div class="eclipse-info">
            <h4>Eclipse Lunar Total</h4>
            <p><strong>Fato:</strong> Este evento marca o in√≠cio de uma s√©rie de eclipses que ser√£o vis√≠veis em grandes partes da Europa e √Åfrica, al√©m das Am√©ricas.</p>
        </div>
        <a class="nasa-link" href="https://eclipse.gsfc.nasa.gov/lunar.html" target="_blank">DADOS NASA</a>
    </div>
</div>
  
  <center>
  <div class="slider-container">
    <div class="mathematician-quote">
        <p>"A Geometria existia antes da Cria√ß√£o. Ela √© co-eterna com a mente de Deus... a Geometria forneceu a Deus um modelo para a Cria√ß√£o."</p>
        <small>‚Äî Johannes Kepler, Matem√°tico e Astr√¥nomo</small>
    </div>

    <div class="slider-track" id="sliderTrack">
        <a class="slide-card" href="https://henriqueiatech.github.io/qatlli/orbitasmatematica.html">
            <div class="slide-img" style="background-image: url('https://images.unsplash.com/photo-1532693322450-2cb5c511067d?auto=format&amp;fit=crop&amp;w=600&amp;q=80');"></div>
            <div class="slide-footer">√ìrbitas Matem√°ticas</div>
        </a>

        <a class="slide-card" href="https://henriqueiatech.github.io/qatlli/aproporcaoaurea.html">
            <div class="slide-img" style="background-image: url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&amp;fit=crop&amp;w=600&amp;q=80');"></div>
            <div class="slide-footer">A Propor√ß√£o √Åurea</div>
        </a>

        <a class="slide-card" href="https://henriqueiatech.github.io/qatlli/geometriadecrateras.html">
            <div class="slide-img" style="background-image: url('https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?auto=format&amp;fit=crop&amp;w=350&amp;q=40');"></div>
            <div class="slide-footer">Geometria de Crateras</div>
        </a>

        <a class="slide-card" href="https://henriqueiatech.github.io/qatlli/simetriadasmares.html">
            <div class="slide-img" style="background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&amp;fit=crop&amp;w=350&amp;q=40');"></div>
            <div class="slide-footer">Simetria das Mar√©s</div>
        </a>

    </div>
</div>
  </center>
  
  <style>
    .literature-section {
        width: 100%;
        max-width: 800px;
        margin-bottom: 60px;
    }
    .lit-category {
        margin-top: 30px;
        border-top: 1px solid var(--light-green);
        padding-top: 20px;
    }
    .lit-category h4 {
        color: var(--accent-green);
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 2px;
        margin-bottom: 20px;
    }
    .book-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    .book-card {
        background: #fcfcfc;
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid var(--primary-green);
    }
    .book-title {
        font-weight: bold;
        color: var(--primary-green);
        display: block;
        margin-bottom: 5px;
    }
    .book-desc {
        font-size: 0.85rem;
        line-height: 1.5;
        color: #555;
    }
    .anthropology-highlight {
        background: var(--light-green);
        padding: 25px;
        border-radius: 15px;
        margin-top: 30px;
        text-align: center;
    }
</style>

<div class="literature-section">
    <h3 class="themes-title">A Lua na Literatura</h3>
    
    <div class="lit-category">
        <h4>Fic√ß√£o Cient√≠fica e Aventura</h4>
        <div class="book-grid">
            <div class="book-card">
                <span class="book-title">Da Terra √† Lua (J√∫lio Verne, 1865)</span>
                <p class="book-desc">Um marco pioneiro que narra a tentativa de um clube de atirar um proj√©til √† Lua, com uma precis√£o cient√≠fica surpreendente para a √©poca.</p>
            </div>
            <div class="book-card">
                <span class="book-title">Tintim na Lua (Herg√©)</span>
                <p class="book-desc">Cl√°ssico dos quadrinhos que explorou a ida √† Lua com aventura e teorias antecipadas aos anos 50.</p>
            </div>
        </div>
    </div>

    <div class="lit-category">
        <h4>Literatura Infantil e Poesia</h4>
        <div class="book-grid">
            <div class="book-card">
                <span class="book-title">Qual o Sabor da Lua? (Michael Grejniec)</span>
                <p class="book-desc">Uma f√°bula po√©tica sobre animais que se unem para tentar alcan√ßar e provar um pequeno peda√ßo da Lua.</p>
            </div>
            <div class="book-card">
                <span class="book-title">Dia de Lua (Renato Moricone)</span>
                <p class="book-desc">Uma obra visualmente rica que imagina as atividades da Lua quando ela n√£o est√° iluminando o nosso c√©u noturno.</p>
            </div>
        </div>
    </div>

    <div class="anthropology-highlight">
        <span class="book-title">A Outra Face da Lua (Claude L√©vi-Strauss)</span>
        <p class="book-desc" style="font-style: italic;">"Nesta obra, o mestre da antropologia explora como a Lua moldou mitos e a organiza√ß√£o de diferentes culturas, revelando seu papel como espelho da humanidade."</p>
    </div>
</div>
  
  
  
    <div class="moon-content">
        <h2>A Lua e suas Influ√™ncias</h2>
        <p>
            Desde o in√≠cio dos tempos, a Lua tem sido a sentinela silenciosa da Terra, exercendo um fasc√≠nio inigual√°vel sobre a humanidade. 
            Muito mais do que um simples sat√©lite natural, ela √© o motor das mar√©s, o guia dos calend√°rios antigos e uma fonte constante de 
            inspira√ß√£o po√©tica e m√≠stica.
        </p>

        <ul class="topic-list">
            <li>
                <span class="topic-title">Hist√≥ria da Lua</span>
                A teoria mais aceita, a "Hip√≥tese do Grande Impacto", sugere que a Lua nasceu h√° 4,5 bilh√µes de anos, quando um corpo do tamanho de Marte colidiu com a Terra jovem. Desde ent√£o, ela estabiliza a inclina√ß√£o do nosso planeta, permitindo a exist√™ncia das esta√ß√µes do ano e um clima prop√≠cio √† vida.
            </li>
            <li>
                <span class="topic-title">Vibra√ß√µes e Energias</span>
                Na metaf√≠sica, cada fase lunar carrega uma vibra√ß√£o: a Lua Nova √© o plantio de inten√ß√µes; a Crescente √© o desenvolvimento; a Cheia √© o √°pice e a clareza; e a Minguante √© a introspec√ß√£o e o desapego.
            </li>
            <li>
                <span class="topic-title">Influ√™ncia na Agricultura</span>
                Agricultores de todo o mundo observam a Lua para o plantio. Acredita-se que a Lua Crescente favorece plantas que crescem para cima (folhas e frutos), enquanto a Minguante √© ideal para ra√≠zes e podas, pois a seiva se concentra na parte inferior da planta.
            </li>
            <li>
                <span class="topic-title">O Ritmo das Mar√©s</span>
                A gravidade lunar puxa as massas de √°gua dos oceanos, criando o fluxo e refluxo das mar√©s. Este ciclo √© vital para a ecologia marinha, regulando a alimenta√ß√£o e reprodu√ß√£o de milhares de esp√©cies.
                
            </li>
            <li>
                <span class="topic-title">A Mulher e o Homem</span>
                Historicamente, o ciclo lunar de 29,5 dias √© associado ao ciclo biol√≥gico feminino, simbolizando fertilidade e renova√ß√£o. Nos homens, estudos sugerem que as fases lunares podem influenciar sutilmente a qualidade do sono e os n√≠veis de melatonina, afetando o humor e a disposi√ß√£o.
            </li>
            <li>
                <span class="topic-title">Fatos Marcantes</span>
                Desde as primeiras observa√ß√µes de Galileu em 1609 at√© o hist√≥rico "pequeno passo" de Neil Armstrong em 1969, a Lua foi o primeiro corpo celeste a ser tocado pelo homem, expandindo os limites da nossa exist√™ncia para al√©m da atmosfera terrestre.
            </li>
        </ul>
    </div>
</center>
  <footer class="site-footer">
    <div class="footer-content">
        <p>¬© 2025 QATLLI - Encantos da Lua. Todos os direitos reservados.</p>
        <p>Dados astron√¥micos baseados em algoritmos de precis√£o J2000. Refer√™ncias de eclipses via NASA Goddard Space Flight Center.</p>
      <p>Criada em 27 de dezembro de 2025<p>
        <div class="footer-links">
            <a href="#">Sobre o Projeto</a> | 
            <a href="#">Privacidade</a> | 
            <a href="#">Fontes Liter√°rias</a>
        </div>
        <p style="margin-top: 10px; opacity: 0.7;">Desenvolvido com paix√£o por Astronomia e Literatura.</p>
      <p><i> "O QATLLI √© uma fus√£o entre o c√©u e a alma. Um espa√ßo onde a precis√£o da astronomia encontra a sensibilidade da literatura, mediadas por uma intelig√™ncia artificial que entende n√£o apenas os ciclos da lua, mas os ciclos do sentimento humano."</i></p>
    </p></p></div>
</footer>

<style>
    .site-footer {
        width: 100%;
        background-color: #f9f9f9;
        padding: 30px 20px;
        margin-top: 80px;
        border-top: 1px solid #eee;
        text-align: center;
    }
    .footer-content {
        max-width: 800px;
        margin: 0 auto;
        font-size: 0.75rem; /* Letras pequenas */
        color: #888;
        line-height: 1.6;
    }
    .footer-links {
        margin: 10px 0;
    }
    .footer-links a {
        color: var(--primary-green);
        text-decoration: none;
        margin: 0 5px;
        transition: 0.2s;
    }
    .footer-links a:hover {
        text-decoration: underline;
        color: var(--accent-green);
    }
</style>
  
  
  
  
    <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0';

    let classifier;
    let currentYear = 2026;
    const monthsNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];

    // --- L√ìGICA ASTRON√îMICA (PRECIS√ÉO J2000) ---
    function calculateMoonPhase(date) {
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        
        let y = year, m = month;
        if (m <= 2) { y -= 1; m += 12; }
        let a = Math.floor(y / 100);
        let b = 2 - a + Math.floor(a / 4);
        let jd = Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + day + b - 1524.5;
        
        const daysSinceJ2000 = jd - 2451549.5;
        const newMoons = daysSinceJ2000 / 29.530588853;
        const phase = (newMoons - Math.floor(newMoons)) * 29.53;
        
        if (phase < 1.0 || phase > 28.5) return { nome: "Lua Nova", icone: "üåë", conselho: "Momento de introspec√ß√£o e novos come√ßos." };
        if (phase < 6.3) return { nome: "Lua Crescente", icone: "üåí", conselho: "D√™ corpo aos seus planos." };
        if (phase < 8.3) return { nome: "Quarto Crescente", icone: "üåì", conselho: "Aja com firmeza e determina√ß√£o." };
        if (phase < 13.7) return { nome: "Crescente Gibosa", icone: "üåî", conselho: "Aperfei√ßoe seus m√©todos e detalhes." };
        if (phase < 15.8) return { nome: "Lua Cheia", icone: "üåï", conselho: "Clareza total, celebra√ß√£o e exposi√ß√£o." };
        if (phase < 21.1) return { nome: "Minguante Gibosa", icone: "üåñ", conselho: "Avalie resultados e compartilhe sabedoria." };
        if (phase < 23.1) return { nome: "Quarto Minguante", icone: "üåó", conselho: "Solte o que n√£o serve mais. Limpeza." };
        return { nome: "Lua Minguante", icone: "üåò", conselho: "Descanso profundo e sil√™ncio mental." };
    }

    // --- GERENCIAMENTO DO CALEND√ÅRIO ---
    function getLunarPhasesForMonthHeader(year, month) {
        let phases = { "üåë": null, "üåì": null, "üåï": null, "üåó": null };
        for (let d = 1; d <= 31; d++) {
            let dObj = new Date(year, month, d);
            if (dObj.getMonth() !== month) break;
            let p = calculateMoonPhase(dObj);
            if (!phases["üåë"] && p.nome === "Lua Nova") phases["üåë"] = d;
            if (!phases["üåì"] && p.nome === "Quarto Crescente") phases["üåì"] = d;
            if (!phases["üåï"] && p.nome === "Lua Cheia") phases["üåï"] = d;
            if (!phases["üåó"] && p.nome === "Quarto Minguante") phases["üåó"] = d;
        }
        return phases;
    }

    window.verDia = (d, m, y) => {
        const data = new Date(y, m, d);
        const info = calculateMoonPhase(data);
        document.getElementById('modal-data').innerText = `${d} de ${monthsNames[m]}`;
        document.getElementById('modal-icone').innerText = info.icone;
        document.getElementById('modal-fase-nome').innerText = info.nome;
        document.getElementById('modal-conselho').innerText = info.conselho;
        document.getElementById('modal-lunar').style.display = 'flex';
    };

    window.fecharModal = () => { document.getElementById('modal-lunar').style.display = 'none'; }

    function createCalendar(year) {
        const container = document.getElementById('calendar');
        container.innerHTML = '';
        const hoje = new Date();
        monthsNames.forEach((name, index) => {
            const monthDiv = document.createElement('div');
            monthDiv.className = 'month';
            let html = `<div class="month-name">${name}</div>`;
            const phases = getLunarPhasesForMonthHeader(year, index);
            html += `<div class="month-lunar-phases">`;
            if(phases["üåë"]) html += `<span>üåë ${phases["üåë"]}</span>`;
            if(phases["üåì"]) html += `<span>üåì ${phases["üåì"]}</span>`;
            if(phases["üåï"]) html += `<span>üåï ${phases["üåï"]}</span>`;
            if(phases["üåó"]) html += `<span>üåó ${phases["üåó"]}</span>`;
            html += `</div><div class="days-grid">`;
            const daysInMonth = new Date(year, index + 1, 0).getDate();
            for(let d = 1; d <= daysInMonth; d++) {
                const isToday = hoje.getFullYear() === year && hoje.getMonth() === index && hoje.getDate() === d;
                html += `<div class="day ${isToday ? 'today' : ''}" onclick="verDia(${d}, ${index}, ${year})">${d}</div>`;
            }
            html += `</div>`;
            monthDiv.innerHTML = html;
            container.appendChild(monthDiv);
        });
    }

    window.changeYear = (delta) => {
        currentYear += delta;
        document.getElementById('year-display').innerText = currentYear;
        createCalendar(currentYear);
    };

    // --- L√ìGICA DA INTELIG√äNCIA ARTIFICIAL QATLLI ---
    async function init() {
        createCalendar(currentYear);
        try {
            // Carregando o modelo Multil√≠ngue
            classifier = await pipeline('sentiment-analysis', 'Xenova/bert-base-multilingual-uncased-sentiment');
            document.getElementById('texto-ia').disabled = false;
            const btn = document.getElementById('btn-ia');
            btn.disabled = false;
            btn.innerText = "Analisar com QATLLI";
        } catch (e) { 
            console.error("Erro ao carregar IA:", e);
            document.getElementById('btn-ia').innerText = "Erro ao carregar motor de IA";
        }
    }

    window.analisar = async () => {
        const input = document.getElementById('texto-ia');
        const resDiv = document.getElementById('resultado');
        if(!input.value) return;

        resDiv.style.display = 'block';
        resDiv.style.borderLeft = "4px solid var(--primary-green)";
        resDiv.innerHTML = "<em>Sintonizando com as energias e folheando os cl√°ssicos...</em>";

        const result = await classifier(input.value);
        const score = parseInt(result[0].label.split(' ')[0]); 
        
        let vibe = "";
        let recomendacao = "";
        let livro = "";

        // L√≥gica de Curadoria Liter√°ria baseada no sentimento
        if (score >= 4) {
            vibe = "Serena e Harmoniosa";
            livro = "<strong>Qual o Sabor da Lua? (Michael Grejniec)</strong>";
            recomendacao = `Sua energia est√° radiante e leve. Que tal manter essa do√ßura com esta f√°bula po√©tica sobre uni√£o e descoberta?`;
        } else if (score === 3) {
            vibe = "Equilibrada e Curiosa";
            livro = "<strong>Da Terra √† Lua (J√∫lio Verne)</strong>";
            recomendacao = `Voc√™ parece estar em um momento de busca e estabilidade. A mente vision√°ria de Verne √© a companhia ideal para expandir seus horizontes hoje.`;
        } else {
            vibe = "Profunda e Reflexiva";
            livro = "<strong>A Outra Face da Lua (Claude L√©vi-Strauss)</strong>";
            recomendacao = `Sentimentos densos pedem um olhar mais profundo. Mergulhe nos mitos e na cultura para entender as diversas faces da alma humana atrav√©s do tempo.`;
        }

        // Se o texto for uma pergunta curta ou demonstrar muita curiosidade
        if (input.value.includes('?') || (input.value.length < 30 && score >= 3)) {
            vibe = "Exploradora e Aventureira";
            livro = "<strong>Tintim na Lua (Herg√©)</strong>";
            recomendacao = `Sua curiosidade est√° agu√ßada! Uma aventura cl√°ssica, visual e cheia de descobertas √© o que o seu esp√≠rito pede agora.`;
        }

        resDiv.innerHTML = `
            <div style="margin-bottom: 10px;"><strong>QATLLI identifica:</strong> Energia <u>${vibe}</u>.</div>
            <div style="font-size: 0.95rem; color: #444; border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px;">
                <span style="color: var(--primary-green); font-weight: bold;">Sugest√£o Liter√°ria do Or√°culo:</span><br>
                ${recomendacao}<br><br>
                üìñ ${livro}
            </div>
        `;
    }

    // Inicializa tudo ao carregar a p√°gina
    init();
</script>
</body>
</html>
